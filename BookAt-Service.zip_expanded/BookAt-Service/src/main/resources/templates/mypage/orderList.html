<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>주문/배송 조회 - BookAt</title>
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <link rel="stylesheet" th:href="@{/css/footer.css}" />
    <link rel="stylesheet" th:href="@{/css/mypage.css}" />
    <link rel="stylesheet" th:href="@{/css/orderlist.css}" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script th:src="@{/js/utils/axiosIntercepter.js}"></script>
    <script th:src="@{/js/utils/logout.js}"></script>
    <script th:src="@{/js/utils/userAuth.js}"></script>
    <script th:src="@{/js/utils/header.js}"></script>
  </head>
  <body>
    <div th:replace="~{fragments/header :: main-header}"></div>

    <main class="mypage-wrapper">
      <div th:replace="~{fragments/MypageAside :: mypageAside('order')}"></div>

      <section class="mypage-main">
        <div class="page-head">
          <h1 class="page-head__title">주문/배송 조회</h1>
          <p class="page-head__meta">최근 6개월 간의 주문 내역을 확인하세요.</p>
        </div>

        <div class="orderlist-wrapper">
          <section class="orderlist-status-panel" id="statusPanel" style="display: none">
            <div class="status-box">
              <div class="status-item">
                <span class="status-label">배송준비중 (결제완료)</span>
                <span class="status-count" data-type="ready">0</span>
              </div>
              <div class="status-item">
                <span class="status-label">배송중</span>
                <span class="status-count" data-type="shipping">0</span>
              </div>
              <div class="status-item">
                <span class="status-label">배송완료</span>
                <span class="status-count" data-type="completed">0</span>
              </div>
              <div class="status-item">
                <span class="status-label">교환/반품/취소</span>
                <span class="status-count" data-type="return">0</span>
              </div>
            </div>
          </section>

          <section class="orderlist-recent" id="orderSection" style="display: none">
            <header class="recent-header">
              <h2>최근 주문 <span class="recent-period">(최근 6개월 이내)</span></h2>
            </header>

            <div class="order-history" id="orderHistory"></div>
            <div class="order-empty" id="orderEmpty" style="display: none">
              <p>조회 가능한 주문이 없습니다.</p>
            </div>
          </section>

          <section class="orderlist-guide" id="guideSection" style="display: none">
            <div class="guide-card">
              <p>새로운 주문을 진행하시겠어요?</p>
              <a class="btn-primary" th:href="@{/books}">도서 둘러보기</a>
            </div>
          </section>

          <section class="orderlist-login" id="loginSection" style="display: none">
            <div class="login-callout">
              <p>로그인이 필요한 서비스입니다.</p>
              <a class="btn-primary" th:href="@{/user/login}">로그인하기</a>
            </div>
          </section>
        </div>
      </section>
    </main>

    <div th:replace="~{fragments/footer :: main-footer}"></div>

    <form id="trackingForm" action="https://info.sweettracker.co.kr/tracking/4" method="post" target="trackingPopup" style="display: none">
      <input type="hidden" name="t_key" th:value="${sweetTrackerApiKey}" />
      <input type="hidden" name="t_code" value="04" />
      <input type="hidden" name="t_invoice" />
    </form>

    <div id="reviewModal" class="modal-overlay review-modal" style="display: none">
      <div class="modal-content">
        <button type="button" class="close-btn" aria-label="close">&times;</button>
        <h2>리뷰 작성</h2>
        <p id="reviewTargetLabel" class="modal-target" style="display: none"></p>
        <form id="reviewForm">
          <input type="hidden" id="reviewOrderId" name="orderId" />
          <input type="hidden" id="reviewBookId" name="bookId" />
          <div class="form-group">
            <label for="reviewRating">별점</label>
            <div class="stars-input" id="reviewStars">
              <span class="star" data-value="1">★</span>
              <span class="star" data-value="2">★</span>
              <span class="star" data-value="3">★</span>
              <span class="star" data-value="4">★</span>
              <span class="star" data-value="5">★</span>
            </div>
            <input type="hidden" id="reviewRating" name="rating" value="0" required />
          </div>
          <div class="form-group">
            <label for="reviewContent">리뷰 내용</label>
            <textarea id="reviewContent" name="content" rows="6" placeholder="리뷰 내용을 입력해주세요." required></textarea>
          </div>
          <button type="submit" class="submit-btn">등록하기</button>
        </form>
      </div>
    </div>

    <script th:src="@{/js/mypage/orderList.js}"></script>
    <script th:src="@{/js/mypage/myReview.js}"></script>
  </body>
</html>
