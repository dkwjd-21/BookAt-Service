<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head><meta charset="UTF-8"><title>결제</title></head>
<body>
  <h2>결제 테스트</h2>
  <p>금액: <span th:text="${amount}"></span>원</p>

  <form id="completeForm" th:action="@{/payment/complete}" method="post" style="display:none;">
    <input type="hidden" name="imp_uid" id="imp_uid">
    <input type="hidden" name="merchant_uid" th:value="${merchantUid}">
     
  </form>

  <button id="payBtn">결제하기</button>

<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
<script th:inline="javascript">
  IMP.init("imp55525217");

  document.getElementById("payBtn").onclick = function(){
    const merchantUid = /*[[${merchantUid}]]*/ '';
    const amount = /*[[${amount}]]*/ 0;

    IMP.request_pay({
      pg: "html5_inicis",
      pay_method: "card",
      name: "북캣 테스트 결제",
      merchant_uid: merchantUid,
      amount: amount
    }, function (rsp) {
      if (rsp.success) {
        document.getElementById("imp_uid").value = rsp.imp_uid;
        document.getElementById("completeForm").submit();
      } else {
        alert("결제 실패: " + rsp.error_msg);
      }
    });
  };
</script>
</body>
</html>