<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bookat.mapper.AddressMapper">

    <!-- 사용자 ID로 배송지 목록 조회 -->
    <select id="findByUserId" parameterType="String" resultType="com.bookat.entity.Address">
        SELECT addr_id, user_id, addr_name, recipient_name, recipient_phone, addr
        FROM addresses
        WHERE user_id = #{userId}
        ORDER BY addr_id
    </select>

    <!-- 사용자 ID로 기본 배송지 조회 (첫 번째 배송지) -->
    <select id="findDefaultByUserId" parameterType="String" resultType="com.bookat.entity.Address">
        SELECT addr_id, user_id, addr_name, recipient_name, recipient_phone, addr
        FROM addresses
        WHERE user_id = #{userId}
        ORDER BY addr_id
        FETCH FIRST 1 ROWS ONLY
    </select>

    <!-- 배송지 추가 -->
    <insert id="insert" parameterType="com.bookat.entity.Address">
        <selectKey keyProperty="addrId" resultType="int" order="BEFORE">
            SELECT SEQ_ADDR.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO addresses (addr_id, user_id, addr_name, recipient_name, recipient_phone, addr)
        VALUES (#{addrId}, #{userId}, #{addrName}, #{recipientName}, #{recipientPhone}, #{addr})
    </insert>

    <!-- 배송지 수정 -->
    <update id="update" parameterType="com.bookat.entity.Address">
        UPDATE addresses
        SET addr_name = #{addrName},
            recipient_name = #{recipientName},
            recipient_phone = #{recipientPhone},
            addr = #{addr}
        WHERE addr_id = #{addrId} AND user_id = #{userId}
    </update>

    <!-- 배송지 삭제 -->
    <delete id="delete" parameterType="int">
        DELETE FROM addresses WHERE addr_id = #{addrId}
    </delete>

</mapper>
