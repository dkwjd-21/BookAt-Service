<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bookat.mapper.BookMapper">

  <!-- 신간: PUBDATE 최신순 -->
  <select id="findNewBooks" parameterType="int" resultType="Book">
    SELECT
      book_id, book_title, book_cover, author, book_price,
      publisher, pubdate, description
    FROM book
    ORDER BY pubdate DESC, book_id DESC
    FETCH FIRST #{limit} ROWS ONLY
  </select>

  <!-- 베스트셀러: ORDER_ITEM.order_quantity 합계 기준 -->
  <select id="findBestSellers" parameterType="int" resultType="Book">
    SELECT
      b.book_id, b.book_title, b.book_cover, b.author, b.book_price,
      b.publisher, b.pubdate, b.description
    FROM book b
    JOIN (
      SELECT book_id, SUM(order_quantity) AS qty
      FROM order_item
      GROUP BY book_id
    ) s ON s.book_id = b.book_id
    ORDER BY s.qty DESC, b.book_id
    FETCH FIRST #{limit} ROWS ONLY
  </select>

  <!-- 이벤트 진행 중 도서: EVENT에 연결된 BOOK -->
  <select id="findEventBooks" parameterType="int" resultType="Book">
    SELECT DISTINCT
      b.book_id, b.book_title, b.book_cover, b.author, b.book_price,
      b.publisher, b.pubdate, b.description
    FROM book b
    JOIN event e ON e.book_id = b.book_id
    -- 필요 시 상태/기간 조건 추가: WHERE e.event_date >= SYSDATE
    FETCH FIRST #{limit} ROWS ONLY
  </select>

</mapper>